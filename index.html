<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korea Bike Trip - Day 1</title>

    <!-- Import the scrolly-video library -->
    <script src="https://cdn.jsdelivr.net/npm/scrolly-video@latest/dist/scrolly-video.js"></script>
    
    <!-- External stylesheet -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Opening page with bike image -->
    <div class="opening-page">
        <div class="bike-image-container">
            <img src="pages/krzineCover1.jpg" alt="Biking Korea" class="bike-image">
        </div>
        <div class="scroll-indicator">
            <div class="scroll-arrow">â†“</div>
        </div>
    </div>

    <!-- Left Page (p1) - Layered page section structured like the video sections -->
    <div class="scrolly-container layered-page-section" id="p1-section">
        <!-- Layered image sticky container -->
        <div id="layered-section">
            <div class="layered-container">
                <!-- Base layer (always visible) -->
                <img src="pages/p1/p1_1.png" alt="Page 1 Layer 1" class="layer-image base-layer">
                
                <!-- Additional layers that appear on scroll -->
                <img src="pages/p1/p1_2.png" alt="Page 1 Layer 2" class="layer-image scroll-layer" data-layer="2">
                <img src="pages/p1/p1_3.png" alt="Page 1 Layer 3" class="layer-image scroll-layer" data-layer="3">
                <img src="pages/p1/p1_4.png" alt="Page 1 Layer 4" class="layer-image scroll-layer" data-layer="4">
                <img src="pages/p1/p1_5.png" alt="Page 1 Layer 5" class="layer-image scroll-layer" data-layer="5">
            </div>
        </div>
        
        <!-- Empty div to create scroll space for layered effect -->
        <div class="scroll-space"></div>
    </div>
    
    <!-- Right Page (p2) - Layered page section structured like the video sections -->
    <div class="scrolly-container layered-page-section" id="p2-section">
        <!-- Layered image sticky container -->
        <div id="layered-section-2">
            <div class="layered-container">
                <!-- Base layer (always visible) -->
                <img src="pages/p2/p2_1.png" alt="Page 2 Layer 1" class="layer-image base-layer">
                
                <!-- Additional layers that appear on scroll -->
                <img src="pages/p2/p2_2.png" alt="Page 2 Layer 2" class="layer-image scroll-layer" data-layer="2">
                <img src="pages/p2/p2_3.png" alt="Page 2 Layer 3" class="layer-image scroll-layer" data-layer="3">
                <img src="pages/p2/p2_4.png" alt="Page 2 Layer 4" class="layer-image scroll-layer" data-layer="4">
                <img src="pages/p2/p2_5.png" alt="Page 2 Layer 5" class="layer-image scroll-layer" data-layer="5">
            </div>
        </div>
        
        <!-- Empty div to create scroll space for layered effect -->
        <div class="scroll-space"></div>
    </div>

    <!-- Text section after layered section -->
    <div class="text-section">
        <div class="text-content">
            <h2>Day 1: Guri to Yeoju</h2>
            <p>This is where you can write about the beginning of your journey. Describe the excitement of starting the trip, the weather, your feelings, or any interesting encounters from the first day.</p>
            <p>You can add multiple paragraphs here to tell the full story of your first day on the road. Include details about the route, the scenery, the challenges, and the highlights.</p>
        </div>
    </div>

    <!-- Main container for the scrolly experience -->
    <div class="scrolly-container">

        <!-- Video container -->
        <div id="scrolly-video"></div>

        <!-- Empty div to create scroll space -->
        <div class="scroll-space"></div>

    </div>

    <!-- Text section after first video -->
    <div class="text-section">
        <div class="text-content">
            <h2>Reflections on Day 1</h2>
            <p>Here you can write about your thoughts after completing the first day. What surprised you? What was easier or harder than expected? Any memorable moments or lessons learned?</p>
            <p>This is also a good place to mention any gear that worked well or didn't work as expected, or any adjustments you made to your setup.</p>
        </div>
    </div>

    <!-- Text section before second video -->
    <div class="text-section">
        <div class="text-content">
            <h2>Day 2: Yeoju to Chungju</h2>
            <p>Write about your second day here. Describe the morning routine, the new challenges you faced, and how the journey is progressing.</p>
            <p>Include details about the landscape changes, any interesting towns you passed through, or encounters with locals.</p>
        </div>
    </div>

    <!-- Second video section -->
    <div class="scrolly-container">
        <!-- Video container -->
        <div id="scrolly-video-2"></div>
        
        <!-- Empty div to create scroll space -->
        <div class="scroll-space"></div>
    </div>

    <!-- Text section after second video -->
    <div class="text-section">
        <div class="text-content">
            <h2>Day 2 Reflections</h2>
            <p>Reflect on the second day of your journey. How are you adapting to the routine? Any new insights about yourself or the trip?</p>
        </div>
    </div>

    <script>
        // Initialize the first ScrollyVideo
        new ScrollyVideo({
            scrollyVideoContainer: "scrolly-video",
            src: "video/day1_1.mp4",
            transitionSpeed: 1, // Reduced from 2 for smoother transitions
            frameThreshold: 0.1,
            useWebCodecs: true, // Enable WebCodecs for better performance
            trackScroll: true,
            lockScroll: false,
            debug: true,
            objectFit: "contain"
        });

        // Initialize the second ScrollyVideo
        new ScrollyVideo({
            scrollyVideoContainer: "scrolly-video-2",
            src: "video/day2_1.mp4",
            transitionSpeed: 1, // Reduced from 2 for smoother transitions
            frameThreshold: 0.1,
            useWebCodecs: true, // Enable WebCodecs for better performance
            trackScroll: true,
            lockScroll: false,
            debug: true,
            objectFit: "contain"
        });

        // Enhanced scroll effect for layered images that mimics ScrollyVideo behavior
        function handleLayeredSectionScroll(sectionId, layeredSectionId) {
            const layeredPageSection = document.getElementById(sectionId);
            const layeredSection = document.getElementById(layeredSectionId);
            if (!layeredPageSection || !layeredSection) return;
            
            const scrollLayers = layeredSection.querySelectorAll('.scroll-layer');
            
            // Get the scroll space within the layered section
            const scrollSpace = layeredPageSection.querySelector('.scroll-space');
            if (!scrollSpace) return;
            
            // Calculate scroll progress based on position in the section
            const sectionTop = layeredPageSection.offsetTop;
            const sectionHeight = scrollSpace.offsetHeight + window.innerHeight; // Total scrollable height
            const scrollTop = window.pageYOffset;
            
            // Calculate how far we've scrolled through the section
            // We start counting once the section comes into view
            const scrollPosition = Math.max(0, scrollTop - sectionTop);
            const scrollProgress = Math.min(1, scrollPosition / (sectionHeight - window.innerHeight));
            
            // Calculate which layers should be visible
            const totalLayers = scrollLayers.length;
            
            scrollLayers.forEach((layer, index) => {
                // Distribute thresholds evenly from 0 to 0.9 (saving the last 10% for after all layers are visible)
                const layerThreshold = index / (totalLayers + 1);  
                
                if (scrollProgress >= layerThreshold) {
                    layer.classList.add('visible');
                } else {
                    layer.classList.remove('visible');
                }
            });
        }
        
        window.addEventListener('scroll', function() {
            // Handle first layered section (p1)
            handleLayeredSectionScroll('p1-section', 'layered-section');
            
            // Handle second layered section (p2)
            handleLayeredSectionScroll('p2-section', 'layered-section-2');
        });
    </script>

</body>
</html>
